/* ==========================================================================
   PRINT.CSS - A4 (10mm Rand & Neue Seiten)
   ========================================================================== */

@media print {
    /* 1. SEITEN-SETUP */
    @page {
        size: A4 portrait;
        margin: 0 !important; /* Wir steuern den Rand manuell */
    }

    html, body {
        width: 210mm;
        margin: 0 !important;
        padding: 0 !important;
        background: #fff !important;
        font-size: 10pt; /* Lesbare Größe */
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        color: #000;
        -webkit-print-color-adjust: exact !important;
    }

    /* 2. CONTAINER */
    .container {
        width: 100% !important;
        max-width: 210mm !important;
        margin: 0 !important;
        padding: 0 !important;
        box-shadow: none !important;
    }

    /* Verstecken von UI Elementen */
    .no-print, .steps, .actions, button, .btn, 
    .btn-del-tranche, .btn-small-ghost, #validationBanner {
        display: none !important;
    }

    /* Alles aufklappen */
    .collapsible, .collapsed {
        display: block !important;
        height: auto !important;
        max-height: none !important;
        opacity: 1 !important;
        visibility: visible !important;
        overflow: visible !important;
    }

    /* 3. SEITEN-STRUKTUR & RÄNDER (Das Herzstück) */
    
    /* Definition aller Haupt-Sektionen */
    #printCoverPage,
    #sectionInputs,
    #sectionResultsP1,
    #sectionResultsP2,
    #sectionResultsRisk,
    #sectionResultsP4,
    #sectionResultsP5,
    #sectionResultsP6,
    #sectionResultsP7 {
        display: block;
        width: 100%;
        
        /* 10mm Rand rundherum */
        padding: 10mm !important; 
        
        box-sizing: border-box;
        
        /* ERZWINGT neue Seite nach jedem Block */
        page-break-after: always !important; 
        break-after: page !important;
    }

    /* Ausnahme: Die allerletzte Seite braucht keinen Umbruch danach */
    #sectionResultsP7 {
        page-break-after: auto !important;
        break-after: auto !important;
    }

    /* Header auf jeder Seite */
    .print-header {
        border-bottom: 2px solid #003366;
        color: #003366;
        font-weight: bold;
        font-size: 10pt;
        margin-bottom: 10mm; /* Abstand zum Inhalt */
        padding-bottom: 2mm;
        display: flex;
        justify-content: space-between;
    }

    /* 4. DECKBLATT (Cover) */
    #printCoverPage {
        /* Deckblatt soll die Seite füllen, aber mit 10mm Rand */
        height: 297mm; 
        display: flex !important;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        background: #003366 !important;
        color: #fff !important;
    }
    /* Logo und Text auf Cover */
    .cover-logo { font-size: 24pt; font-weight: bold; margin-bottom: 20mm; color: #fff !important;}
    .cover-title-block h1 { color: #fff !important; font-size: 36pt; margin-bottom: 10mm; }
    .cover-details { text-align: left; width: 80%; border: 1px solid rgba(255,255,255,0.3); padding: 10mm; margin-top: 20mm;}
    .detail-row { display: flex; justify-content: space-between; border-bottom: 1px solid rgba(255,255,255,0.2); padding: 3mm 0; font-size: 12pt; color: #fff !important; }

    /* 5. INHALTE SICHERN (Kein Umbruch mitten drin) */
    .kpi, .risk-card, .chart-box, .proposal-section, fieldset, .tranche-box {
        page-break-inside: avoid !important;
        break-inside: avoid !important;
        margin-bottom: 5mm;
    }

    /* 6. FORMULARE & CHARTS OPTIMIERUNG */
    
    /* Formular zweispaltig machen um Platz zu sparen */
    .buyer-grid-container {
        display: grid;
        grid-template-columns: 35% 30% 30%; /* Label | K1 | K2 */
        gap: 5px;
        width: 100%;
        margin-bottom: 5mm;
        font-size: 9pt;
    }
    .buyer-separator {
        grid-column: 1 / -1;
        background: #eee !important;
        font-weight: bold;
        padding: 5px;
        margin-top: 5mm;
        color: #000;
        -webkit-print-color-adjust: exact;
    }
    .buyer-header, .buyer-header-label { display: none; } /* Header ausblenden */

    /* Inputs clean machen */
    input, select {
        border: none !important;
        background: transparent !important;
        padding: 0 !important;
        font-weight: 600;
        width: 100%;
        -webkit-appearance: none;
    }
    select { text-indent: 0.01px; text-overflow: ''; }

    /* Charts begrenzen */
    .chart-box, .chart-grid {
        width: 100% !important;
        max-width: 170mm !important; /* Passt genau in den 210mm - 20mm Rand */
        margin: 0 auto 10mm auto;
    }
    .apexcharts-canvas { margin: 0 auto; }

    /* Grids (KPIs, Risiken) */
    .tiles, .tiles-p3 {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 5mm;
    }
    .risk-grid {
        display: grid;
        grid-template-columns: 1fr 1fr; /* 2 Spalten für bessere Lesbarkeit */
        gap: 5mm;
    }
    
    /* Unterschriften */
    .mandate-section {
        border: 1px solid #000;
        padding: 5mm;
        margin-top: 10mm;
    }
    .signature-line {
        border-bottom: 1px solid #000;
        height: 10mm;
        margin-bottom: 2mm;
    }
}